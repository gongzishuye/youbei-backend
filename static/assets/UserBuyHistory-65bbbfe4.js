import{d as F,r as u,c as G,w as J,o as L,a as U,b as k,e as o,u as Q,f as W,E as T,g as r,h as X,i as p,j as g,k as a,l as m,m as Z,n as ee,p as te,t as B,q as ae,s as ne,v as oe,_ as le}from"./index-2179ff4f.js";import{s as se}from"./buys-0e9130bb.js";const re={class:"buy-history"},ie={class:"card-header"},ue={class:"search-bar"},ce={key:0,class:"empty-state"},de={class:"pagination"},pe=F({__name:"UserBuyHistory",setup(me){const x={1:"CNY",2:"USD",3:"HKD",4:"THB",5:"EUR",6:"USDT",7:"USDC"},D=[{label:"种菜",value:1},{label:"种果树",value:2},{label:"钓鱼",value:3},{label:"捡馅饼",value:4},{label:"狩猎",value:5},{label:"生态位",value:6}],I=Q(),N=W(),_=u(!1),c=u([]),f=u(0),d=u(1),S=u(10),v=u(""),h=G(()=>Number(I.params.userId)),E=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),b=(e,n)=>(e==null?void 0:e.toFixed(n))||"-",y=async()=>{var e,n,i;try{_.value=!0;const l=await se({userid:h.value,page:d.value,query:v.value||void 0});l.success?(c.value=l.data||[],f.value=((e=l.data)==null?void 0:e.length)||0,S.value=10):(c.value=[],f.value=0,T.error(l.message||"获取历史记录失败"))}catch(l){c.value=[],f.value=0,T.error(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"获取历史记录失败")}finally{_.value=!1}},w=e=>{d.value=e,y()},C=()=>{d.value=1,y()},O=()=>{N.push({name:"CreateBuyRecord",params:{userId:h.value}})},P=e=>{},V=e=>{var i;const n={id:e.id,buyTime:e.buyTime,assetId:e.assetId,currencyId:e.currencyId,exchangeRate:e.exchangeRate,price:e.price,amount:e.amount,amountOri:e.amountOri,strategy:e.strategy,totalPay:e.totalPay,feeRate:e.feeRate,fee:e.fee,accountId:e.accountId,financing:e.financing,financeRate:e.financeRate,dividendYield:e.dividendYield,desc:e.desc,assets:{id:e.assetId,name:((i=e.assets)==null?void 0:i.name)||""}};sessionStorage.setItem("editBuyRecord",JSON.stringify(n)),N.push({name:"EditBuyRecord",params:{userId:h.value,id:e.id}})};return J(()=>I.name,e=>{e==="UserBuyHistory"&&y()}),L(()=>{y()}),(e,n)=>{const i=r("router-view"),l=r("el-button"),H=r("el-icon"),Y=r("el-input"),s=r("el-table-column"),z=r("el-tag"),M=r("el-table"),K=r("el-empty"),$=r("el-pagination"),q=r("el-card"),A=X("loading");return p(),U("div",re,[e.$route.name==="EditBuyRecord"||e.$route.name==="CreateBuyRecord"?(p(),k(i,{key:0})):(p(),k(q,{key:1},{header:o(()=>[g("div",ie,[n[3]||(n[3]=g("h3",null,"买进历史",-1)),a(l,{type:"primary",onClick:O},{default:o(()=>n[2]||(n[2]=[m("新增记录")])),_:1,__:[2]})])]),default:o(()=>[g("div",ue,[a(Y,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=t=>v.value=t),placeholder:"搜索...",clearable:"",onClear:C,onKeyup:ee(C,["enter"])},{append:o(()=>[a(l,{onClick:C},{default:o(()=>[a(H,null,{default:o(()=>[a(Z(oe))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),te((p(),k(M,{data:c.value,style:{width:"100%"},onRowClick:P},{default:o(()=>[a(s,{prop:"buyTime",label:"购买时间",width:"180",formatter:t=>E(t.buyTime)},null,8,["formatter"]),a(s,{prop:"assets.name",label:"资产名称",width:"180","show-overflow-tooltip":""}),a(s,{label:"币种",width:"100"},{default:o(({row:t})=>[m(B(x[t.currencyId]||"-"),1)]),_:1}),a(s,{prop:"price",label:"价格",width:"120",align:"right",formatter:t=>b(t.price,3)},null,8,["formatter"]),a(s,{prop:"amountOri",label:"原始数量",width:"120",align:"right",formatter:t=>b(t.amountOri,4)},null,8,["formatter"]),a(s,{prop:"amount",label:"剩余数量",width:"120",align:"right",formatter:t=>b(t.amount,4)},null,8,["formatter"]),a(s,{label:"策略",width:"100"},{default:o(({row:t})=>{var R;return[m(B(((R=D.find(j=>j.value===t.strategy))==null?void 0:R.label)||"-"),1)]}),_:1}),a(s,{label:"融资",width:"80"},{default:o(({row:t})=>[a(z,{type:t.financing?"warning":"success"},{default:o(()=>[m(B(t.financing?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),a(s,{prop:"desc",label:"描述","show-overflow-tooltip":""}),a(s,{label:"操作",width:"120",fixed:"right"},{default:o(({row:t})=>[a(l,{link:"",type:"primary",onClick:ae(R=>V(t),["stop"])},{default:o(()=>n[4]||(n[4]=[m(" 编辑 ")])),_:2,__:[4]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,_.value]]),!_.value&&c.value.length===0?(p(),U("div",ce,[a(K,{description:"暂无数据"})])):ne("",!0),g("div",de,[a($,{"current-page":d.value,"onUpdate:currentPage":n[1]||(n[1]=t=>d.value=t),total:f.value,"page-size":S.value,background:"",layout:"total, prev, pager, next",onCurrentChange:w},null,8,["current-page","total","page-size"])])]),_:1}))])}}});const ye=le(pe,[["__scopeId","data-v-c3a2fab2"]]);export{ye as default};
