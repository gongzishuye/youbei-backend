import{d as j,r as g,c as J,w as L,o as O,a as r,b as I,e as s,u as Q,f as G,E as N,g as u,h as W,i as n,j as i,k as a,l as x,m as X,n as Z,p as w,t as c,B as ee,C as m,s as p,q as te,v as ae,_ as le}from"./index-2179ff4f.js";import{g as se}from"./sells-ee34ea61.js";const ie={class:"sell-history"},ne={class:"card-header"},oe={class:"search-bar"},ue={style:{display:"flex","align-items":"center",gap:"4px"}},de={key:0,class:"empty-state"},re={class:"pagination"},ce=j({__name:"UserSellHistory",setup(pe){const D={1:"CNY",2:"USD",3:"HKD",4:"THB",5:"EUR",6:"USDT",7:"USDC"},T=Q(),U=G(),_=g(!1),h=g([]),v=g(0),y=g(1),E=g(10),R=g(""),C=J(()=>Number(T.params.userId)),P=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),k=(e,l)=>(e==null?void 0:e.toFixed(l))||"-",f=async()=>{var e,l,b;try{_.value=!0;const o=await se({userid:C.value,page:y.value,query:R.value||void 0});o.success?(h.value=o.data||[],v.value=((e=o.data)==null?void 0:e.length)||0,E.value=10):(h.value=[],v.value=0,N.error(o.message||"获取历史记录失败"))}catch(o){h.value=[],v.value=0,N.error(((b=(l=o.response)==null?void 0:l.data)==null?void 0:b.message)||"获取历史记录失败")}finally{_.value=!1}},H=e=>{y.value=e,f()},S=()=>{y.value=1,f()},V=()=>{U.push({name:"CreateSellRecord",params:{userId:C.value.toString()}})},z=e=>{const l={id:e.id,sellTime:e.sellTime,assetId:e.assetId,buysId:e.buysId,currencyId:e.currencyId,exchangeRate:e.exchangeRate,sellPrice:e.sellPrice,amount:e.amount,feeRate:e.feeRate,fee:e.fee,distributionType:e.distributionType,distributionId:e.distributionId,fishingRatio:e.fishingRatio,fruitRatio:e.fruitRatio,vegetableRatio:e.vegetableRatio,huntingRatio:e.huntingRatio,ecologyRatio:e.ecologyRatio,pieRatio:e.pieRatio,userId:e.userId,assets:e.assets?{id:e.assets.id,name:e.assets.name}:void 0,buys:e.buys?{id:e.buys.id,assetId:e.buys.assetId,currencyId:e.buys.currencyId,exchangeRate:e.buys.exchangeRate,price:e.buys.price,amount:e.buys.amount,buyTime:e.buys.buyTime,assets:e.buys.assets?{id:e.buys.assets.id,name:e.buys.assets.name}:void 0}:void 0};sessionStorage.setItem("editSellRecord",JSON.stringify(l)),U.push({name:"EditSellRecord",params:{userId:C.value.toString(),id:e.id.toString()}})};return L(()=>T.name,e=>{e==="UserSellHistory"&&f()}),O(()=>{f()}),(e,l)=>{const b=u("router-view"),o=u("el-button"),B=u("el-icon"),F=u("el-input"),d=u("el-table-column"),M=u("el-tooltip"),A=u("el-table"),K=u("el-empty"),$=u("el-pagination"),q=u("el-card"),Y=W("loading");return n(),r("div",ie,[e.$route.name==="EditSellRecord"||e.$route.name==="CreateSellRecord"?(n(),I(b,{key:0})):(n(),I(q,{key:1},{header:s(()=>[i("div",ne,[l[3]||(l[3]=i("h3",null,"卖出历史",-1)),a(o,{type:"primary",onClick:V},{default:s(()=>l[2]||(l[2]=[x("新增记录")])),_:1,__:[2]})])]),default:s(()=>[i("div",oe,[a(F,{modelValue:R.value,"onUpdate:modelValue":l[0]||(l[0]=t=>R.value=t),placeholder:"搜索...",clearable:"",onClear:S,onKeyup:Z(S,["enter"])},{append:s(()=>[a(o,{onClick:S},{default:s(()=>[a(B,null,{default:s(()=>[a(X(ae))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),w((n(),I(A,{data:h.value,style:{width:"100%"}},{default:s(()=>[a(d,{prop:"sellTime",label:"卖出时间",width:"180",formatter:t=>P(t.sellTime)},null,8,["formatter"]),a(d,{prop:"assets.name",label:"资产名称",width:"180","show-overflow-tooltip":""}),a(d,{label:"币种",width:"100"},{default:s(({row:t})=>[x(c(D[t.currencyId]||"-"),1)]),_:1}),a(d,{prop:"sellPrice",label:"卖出价格",width:"120",align:"right",formatter:t=>k(t.sellPrice,3)},null,8,["formatter"]),a(d,{prop:"amount",label:"数量",width:"120",align:"right",formatter:t=>k(t.amount,4)},null,8,["formatter"]),a(d,{prop:"pnl",label:"盈亏",width:"120",align:"right"},{default:s(({row:t})=>[i("span",{class:ee({profit:t.pnl>0,loss:t.pnl<0})},c(k(t.pnl,2)),3)]),_:1}),a(d,{label:"策略分布","min-width":"200"},{default:s(({row:t})=>[a(M,{effect:"dark",placement:"top"},{content:s(()=>[i("div",null,"钓鱼: "+c(t.fishingRatio)+"%",1),i("div",null,"种果树: "+c(t.fruitRatio)+"%",1),i("div",null,"种菜: "+c(t.vegetableRatio)+"%",1),i("div",null,"狩猎: "+c(t.huntingRatio)+"%",1),i("div",null,"生态位: "+c(t.ecologyRatio)+"%",1),i("div",null,"捡馅饼: "+c(t.pieRatio)+"%",1)]),default:s(()=>[i("div",ue,[t.fishingRatio>0?(n(),r("div",{key:0,style:m({width:t.fishingRatio+"%",height:"20px",backgroundColor:"#409EFF"})},null,4)):p("",!0),t.fruitRatio>0?(n(),r("div",{key:1,style:m({width:t.fruitRatio+"%",height:"20px",backgroundColor:"#67C23A"})},null,4)):p("",!0),t.vegetableRatio>0?(n(),r("div",{key:2,style:m({width:t.vegetableRatio+"%",height:"20px",backgroundColor:"#E6A23C"})},null,4)):p("",!0),t.huntingRatio>0?(n(),r("div",{key:3,style:m({width:t.huntingRatio+"%",height:"20px",backgroundColor:"#F56C6C"})},null,4)):p("",!0),t.ecologyRatio>0?(n(),r("div",{key:4,style:m({width:t.ecologyRatio+"%",height:"20px",backgroundColor:"#909399"})},null,4)):p("",!0),t.pieRatio>0?(n(),r("div",{key:5,style:m({width:t.pieRatio+"%",height:"20px",backgroundColor:"#FF9900"})},null,4)):p("",!0)])]),_:2},1024)]),_:1}),a(d,{prop:"desc",label:"描述","show-overflow-tooltip":""}),a(d,{label:"操作",width:"120",fixed:"right"},{default:s(({row:t})=>[a(o,{link:"",type:"primary",onClick:te(ge=>z(t),["stop"])},{default:s(()=>l[4]||(l[4]=[x(" 编辑 ")])),_:2,__:[4]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,_.value]]),!_.value&&h.value.length===0?(n(),r("div",de,[a(K,{description:"暂无数据"})])):p("",!0),i("div",re,[a($,{"current-page":y.value,"onUpdate:currentPage":l[1]||(l[1]=t=>y.value=t),total:v.value,"page-size":E.value,background:"",layout:"total, prev, pager, next",onCurrentChange:H},null,8,["current-page","total","page-size"])])]),_:1}))])}}});const ye=le(ce,[["__scopeId","data-v-3532cdf1"]]);export{ye as default};
